@model CheckOnClick.Models.AdminProfile
@{
    ViewBag.Title = "Profile";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="form-grids row widget-shadow" data-example-id="basic-forms">
    <div class="form-title">
        <h4>My Profile</h4>
    </div>
    <div class="form-body">

        <form method="post">

            <div class="row form-group">
                <div class="col-md-2">
                    <label for="admin_fullName">Full Name</label>
                </div>
                <div class="col-md-8">
                    @Html.TextBoxFor(a => a.Admin_FullName, new { @class = "form-control", @placeholder = "Full Name", @disabled = "disabled" })
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-2">
                    <label for="admin_userName">User Name</label>
                </div>
                <div class="col-md-8">
                    @Html.TextBoxFor(a => a.Admin_UserName, new { @class = "form-control", @placeholder = "User Name", @disabled = "disabled" })
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-2">
                    <label for="admin_email">Email</label>
                </div>
                <div class="col-md-8">
                    @Html.TextBoxFor(a => a.Admin_Email, new { @class = "form-control", @placeholder = "Email", @disabled = "disabled" })
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-2">
                    <label for="admin_contact">Contact Number</label>
                </div>
                <div class="col-md-8">
                    @Html.TextBoxFor(a => a.Admin_Contact, new { @class = "form-control", @placeholder = "Contact Number", @disabled = "disabled" })
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-2">
                    <label for="admin_dob">Date of Birth</label>
                </div>
                <div class="col-md-8">
                    @Html.TextBoxFor(a => a.Admin_DOB, new { @class = "form-control", @placeholder = "Date of Birth", @disabled = "disabled" })
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-2">
                    <label for="admin_addCity">Address: City</label>
                </div>
                <div class="col-md-3">
                    @Html.TextBoxFor(a => a.Admin_City, new { @class = "form-control", @placeholder = "City", @disabled = "disabled" })
                </div>
                <div class="col-md-2">
                    <label for="admin_addState">State</label>
                </div>
                <div class="col-md-3">
                    @Html.TextBoxFor(a => a.Admin_State, new { @class = "form-control", @placeholder = "State", @disabled = "disabled" })
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-2">
                    <label for="admin_addCountry">Country</label>
                </div>
                <div class="col-md-3">
                    @Html.TextBoxFor(a => a.Admin_Country, new { @class = "form-control", @placeholder = "Country", @disabled = "disabled" })
                </div>
                <div class="col-md-2">
                    <label for="admin_addPin">Pin</label>
                </div>
                <div class="col-md-3">
                    @Html.TextBoxFor(a => a.Admin_Pin, new { @class = "form-control", @placeholder = "Pin", @disabled = "disabled" })
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                    <span id="err_profile" style="font-size:12px; color:red;"></span>
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-4" id="edit_div">
                    <button type="button" class="btn btn-block btn-primary" name="admin_profile_edit" id="admin_profile_edit"><i class="fa fa-edit"></i> Edit Profile</button>
                </div>
                <div class="col-md-4" id="save_div">
                    <button type="button" class="btn btn-block btn-success" name="admin_profile_update" id="admin_profile_update"><i class="fa fa-check"></i> Save Changes</button>
                </div>
                <div class="col-md-4">
                    <button type="button" class="btn btn-block btn-primary" name="admin_password_edit" id="admin_password_edit" data-toggle="modal" data-target="#edit_Password"><i class="fa fa-edit"></i> Change Password</button>
                </div>
            </div>

        </form>


        <!-- Modal -->
        <div class="modal fade" id="edit_Password" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h5 class="modal-title" id="exampleModalLabel">Change Password</h5>

                    </div>
                    <div class="modal-body">

                        <form method="post" action="#">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="cur_password">Current Password</label>
                                </div>
                                <div class="col-md-8">
                                    @Html.PasswordFor(a => a.Admin_Password, new { @class = "form-control", @placeholder = "Current Password" })
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <label for="new_password">New Password</label>
                                </div>
                                <div class="col-md-8">
                                    @Html.PasswordFor(a => a.Admin_NewPassword, new { @class = "form-control", @placeholder = "New Password" })
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <label for="retype_password">Re-Type Password</label>
                                </div>
                                <div class="col-md-8">
                                    @Html.PasswordFor(a => a.Admin_RePassword, new { @class = "form-control", @placeholder = "Re-Type Password" })
                                    <span id="err_pass" style="font-size:12px; color:red;"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <button type="button" name="update_password" id="update_password" class="btn btn-success form-control"><i class="fa fa-check"></i> Change Password</button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Close    -->


    </div>

</div>

<script>


    // Displaying profile details in each fields
    $.ajax({
        type: "GET",
        url: "/Admin/GetProfile",
        contentType: "application/json",
        dataType: "json",
        success: function (result) {
            if (result != null) {

                $.each(result, function (i, v1) {

                    $('#Admin_FullName').val(v1.Admin_FullName);
                    $('#Admin_UserName').val(v1.Admin_UserName);
                    $('#Admin_Email').val(v1.Admin_Email);
                    $('#Admin_Contact').val(v1.Admin_Contact);
                    value = new Date(parseInt(v1.Admin_DOB.substr(6)));
                    $('#Admin_DOB').val(value.getDate() + "/" + value.getMonth() + 1 + "/" + value.getFullYear());
                    $('#Admin_City').val(v1.Admin_City);
                    $('#Admin_State').val(v1.Admin_State);
                    $('#Admin_Country').val(v1.Admin_Country);
                    $('#Admin_Pin').val(v1.Admin_Pin);
                });

            }
            else {
                //alert('Something went wrong');
                swal('Error', 'Something went wrong !', 'error');
            }
        },
        failure: function () {
            //alert('Failure');
            swal('Error', 'Failure', 'error');
        },
        error: function () {
            //alert('error');
            swal('Error', 'Error', 'error');
        }
    });


    $("#save_div").hide();

    // Action when we click Edit Profile Button
    $("#admin_profile_edit").click(function () {
        $("#edit_div").hide();
        $("#save_div").show();

        $("#Admin_FullName").removeAttr("disabled");
        $("#Admin_Contact").removeAttr("disabled");
        $("#Admin_City").removeAttr("disabled");
        $("#Admin_State").removeAttr("disabled");
        $("#Admin_Country").removeAttr("disabled");
        $("#Admin_Pin").removeAttr("disabled");
    });

    // Action when we click Update Profile Button
    $('#admin_profile_update').click(function () {

        var valid = true;

        if ($('#Admin_FullName').val() == '') {
            valid = false;
        }
        if ($('#Admin_Contact').val() == '') {
            valid = false;
        }
        if ($('#Admin_City').val() == '') {
            valid = false;
        }
        if ($('#Admin_State').val() == '') {
            valid = false;
        }
        if ($('#Admin_Country').val() == '') {
            valid = false;
        }
        if ($('#Admin_Pin').val() == '') {
            valid = false;
        }

        if (valid == false) {
            $('#err_profile').text('* Please fill all the fields !');
        }
        else {
            $('#err_profile').text('');
            var data = {
                "Admin_FullName": $('#Admin_FullName').val(),
                "Admin_Contact": $('#Admin_Contact').val(),
                "Admin_City": $('#Admin_City').val(),
                "Admin_State": $('#Admin_State').val(),
                "Admin_Country": $('#Admin_Country').val(),
                "Admin_Pin": $('#Admin_Pin').val()

            };

            $.ajax({
                type: "POST",
                url: "/Admin/UpdateProfile",
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (result) {
                    swal('Success', 'Successfully Updated !', 'success')
                        .then((value) => {
                            location.reload(true);
                        });
                },
                failure: function (result) {
                    swal('Error', 'Something went wrong, Please try again !', 'error');
                },
                error: function (result) {
                    swal('Error', 'Someting went wrong, Please try again !', 'error');
                }
            });
        }
    });

    $('#update_password').click(function () {
        var valid = true;
        if ($('#Admin_Password').val() == "") {
            valid = false;
        }
        if ($('#Admin_NewPassword').val() == "") {
            valid = false;
        }
        if ($('#Admin_RePassword').val() == "") {
            valid = false;
        }

        if (valid == false) {
            $('#err_pass').text('* Please fill all the fields !');
        }
        else if ($('#Admin_NewPassword').val() != null && $('#Admin_RePassword').val() != null && $('#Admin_NewPassword').val() != $('#Admin_RePassword').val()) {
            $('#err_pass').text('* New Password and Re-Type Password are mismatched !');
        }
        else {
            $('#err_pass').text('');
            var data = {
                "Admin_Password": $('#Admin_Password').val(),
                "Admin_NewPassword": $('#Admin_NewPassword').val()
            };

            $.ajax({
                type: "POST",
                url: "/Admin/UpdateAdminPassword",
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (result) {
                    if (result == 'notMatch') {
                        swal('Error', 'Current Password is incorrect !', 'error');
                    }
                    else if (result == 'saved') {
                        swal('Success', 'Password successfully changed !', 'success')
                            .then((value) => {
                                location.reload(true);
                            });
                    }
                    else {
                        swal('Error', 'Something went wrong, Please try again !', 'error');
                    }


                },
                error: function (result) {
                    swal('Error', 'Problem changing the password, Please try again !', 'error');
                }
            });
        }
    });
</script>